{"level": "Simple", "question": "What is the total number of orders in the dataset?", "sql_query": "SELECT COUNT(order_id) FROM orders;", "id": 1}
{"level": "Simple", "question": "What is the maximum profit recorded for any single order item?", "sql_query": "SELECT MAX(profit) FROM orders;", "id": 2}
{"level": "Simple", "question": "List the unique product categories available in the orders.", "sql_query": "SELECT DISTINCT category FROM orders;", "id": 3}
{"level": "Simple", "question": "Retrieve all records for orders that were shipped using 'Same Day' mode.", "sql_query": "SELECT * FROM orders WHERE ship_mode = 'Same Day';", "id": 4}
{"level": "Simple", "question": "Find the total sales amount.", "sql_query": "SELECT SUM(sales) FROM orders;", "id": 5}
{"level": "Simple", "question": "How many distinct countries are represented in the orders?", "sql_query": "SELECT COUNT(DISTINCT country) FROM orders;", "id": 6}
{"level": "Simple", "question": "List the first 10 rows from the orders table, ordered by row_id.", "sql_query": "SELECT * FROM orders ORDER BY row_id ASC LIMIT 10;", "id": 7}
{"level": "Simple", "question": "What is the average quantity of products ordered?", "sql_query": "SELECT AVG(quantity) FROM orders;", "id": 8}
{"level": "Simple", "question": "Find all order IDs from the returns table.", "sql_query": "SELECT order_id FROM returns;", "id": 9}
{"level": "Simple", "question": "Retrieve the product name and sales for all items with a discount greater than 0.5.", "sql_query": "SELECT product_name, sales FROM orders WHERE discount > 0.5;", "id": 10}
{"level": "Simple", "question": "What is the total shipping cost?", "sql_query": "SELECT SUM(shipping_cost) FROM orders;", "id": 11}
{"level": "Simple", "question": "List all orders from the 'Home Office' segment.", "sql_query": "SELECT * FROM orders WHERE segment = 'Home Office';", "id": 12}
{"level": "Simple", "question": "How many products belong to the 'Technology' category?", "sql_query": "SELECT COUNT(row_id) FROM orders WHERE category = 'Technology';", "id": 13}
{"level": "Simple", "question": "Find the minimum sales amount in the dataset.", "sql_query": "SELECT MIN(sales) FROM orders;", "id": 14}
{"level": "Simple", "question": "Which ship_mode has an order_priority of 'Critical'?", "sql_query": "SELECT DISTINCT ship_mode FROM orders WHERE order_priority = 'Critical';", "id": 15}
{"level": "Simple", "question": "List the unique regions present in the orders data.", "sql_query": "SELECT DISTINCT region FROM orders;", "id": 16}
{"level": "Simple", "question": "Select the order ID and order date for all orders placed in the year 2014.", "sql_query": "SELECT order_id, order_date FROM orders WHERE order_date LIKE '2014%';", "id": 17}
{"level": "Simple", "question": "How many orders have a profit less than zero (loss)?", "sql_query": "SELECT COUNT(order_id) FROM orders WHERE profit < 0;", "id": 18}
{"level": "Simple", "question": "Find the average profit across all orders.", "sql_query": "SELECT AVG(profit) FROM orders;", "id": 19}
{"level": "Simple", "question": "What are the distinct values for the returned column in the returns table?", "sql_query": "SELECT DISTINCT returned FROM returns;", "id": 20}
{"level": "Simple", "question": "Get the top 5 highest sales records, showing product_name and sales.", "sql_query": "SELECT product_name, sales FROM orders ORDER BY sales DESC LIMIT 5;", "id": 21}
{"level": "Simple", "question": "List the sub-category names under the Furniture category.", "sql_query": "SELECT DISTINCT \"sub-category\" FROM orders WHERE category = 'Furniture';", "id": 22}
{"level": "Simple", "question": "How many orders were placed by the customer with customer_id 'RH-19495'?", "sql_query": "SELECT COUNT(order_id) FROM orders WHERE customer_id = 'RH-19495';", "id": 23}
{"level": "Simple", "question": "Select all columns for orders where country is 'France'.", "sql_query": "SELECT * FROM orders WHERE country = 'France';", "id": 24}
{"level": "Simple", "question": "What is the average discount given?", "sql_query": "SELECT AVG(discount) FROM orders;", "id": 25}
{"level": "Simple", "question": "Find the order ID, ship date, and ship mode for orders with order_priority 'Low'.", "sql_query": "SELECT order_id, ship_date, ship_mode FROM orders WHERE order_priority = 'Low';", "id": 26}
{"level": "Simple", "question": "List the unique markets from the orders table.", "sql_query": "SELECT DISTINCT market FROM orders;", "id": 27}
{"level": "Simple", "question": "Retrieve the total quantity of items sold.", "sql_query": "SELECT SUM(quantity) FROM orders;", "id": 28}
{"level": "Simple", "question": "Find all orders that contain the word 'Chair' in the product_name.", "sql_query": "SELECT * FROM orders WHERE product_name LIKE '%Chair%';", "id": 29}
{"level": "Simple", "question": "How many order records are associated with the 'LATAM' market in the returns table?", "sql_query": "SELECT COUNT(order_id) FROM returns WHERE market = 'LATAM';", "id": 30}
{"level": "Simple", "question": "What is the earliest order_date?", "sql_query": "SELECT MIN(order_date) FROM orders;", "id": 31}
{"level": "Simple", "question": "List the customer names from the 'Consumer' segment.", "sql_query": "SELECT DISTINCT customer_name FROM orders WHERE segment = 'Consumer';", "id": 32}
{"level": "Simple", "question": "Find the sales and profit for orders where quantity is exactly 1.", "sql_query": "SELECT sales, profit FROM orders WHERE quantity = 1;", "id": 33}
{"level": "Simple", "question": "List all orders that were shipped after the order date.", "sql_query": "SELECT * FROM orders WHERE ship_date > order_date;", "id": 34}
{"level": "Intermediate", "question": "Calculate the total sales and total profit for each product category.", "sql_query": "SELECT category, SUM(sales) AS total_sales, SUM(profit) AS total_profit FROM orders GROUP BY category;", "id": 35}
{"level": "Intermediate", "question": "Find the average sales per customer segment.", "sql_query": "SELECT segment, AVG(sales) AS avg_sales FROM orders GROUP BY segment;", "id": 36}
{"level": "Intermediate", "question": "Which country has the highest total profit?", "sql_query": "SELECT country, SUM(profit) AS total_profit FROM orders GROUP BY country ORDER BY total_profit DESC LIMIT 1;", "id": 37}
{"level": "Intermediate", "question": "Count the number of returned orders per market.", "sql_query": "SELECT market, COUNT(order_id) AS returned_count FROM returns GROUP BY market;", "id": 38}
{"level": "Intermediate", "question": "What is the profit margin (total profit / total sales) for each sub-category?", "sql_query": "SELECT \"sub-category\", SUM(profit) * 1.0 / SUM(sales) AS profit_margin FROM orders GROUP BY \"sub-category\";", "id": 39}
{"level": "Intermediate", "question": "Find all orders that have a profit greater than the average profit of all orders.", "sql_query": "SELECT * FROM orders WHERE profit > (SELECT AVG(profit) FROM orders);", "id": 40}
{"level": "Intermediate", "question": "List the product_id and total quantity sold for products where the total quantity sold is greater than 50.", "sql_query": "SELECT product_id, SUM(quantity) AS total_quantity FROM orders GROUP BY product_id HAVING SUM(quantity) > 50;", "id": 41}
{"level": "Intermediate", "question": "How many days, on average, does it take to ship an order for each ship_mode?", "sql_query": "SELECT ship_mode, AVG(JULIANDAY(ship_date) - JULIANDAY(order_date)) AS avg_ship_days FROM orders GROUP BY ship_mode;", "id": 42}
{"level": "Intermediate", "question": "Count the number of orders in each year.", "sql_query": "SELECT CAST(SUBSTR(order_date, 1, 4) AS INT) AS order_year, COUNT(order_id) AS order_count FROM orders GROUP BY order_year;", "id": 43}
{"level": "Intermediate", "question": "Get the customer names who have placed more than 5 orders.", "sql_query": "SELECT customer_name FROM orders GROUP BY customer_name HAVING COUNT(order_id) > 5;", "id": 44}
{"level": "Intermediate", "question": "Find the total sales for non-returned orders.", "sql_query": "SELECT SUM(T1.sales) FROM orders AS T1 LEFT JOIN returns AS T2 ON T1.order_id = T2.order_id WHERE T2.order_id IS NULL;", "id": 45}
{"level": "Intermediate", "question": "Which region has the lowest average shipping cost?", "sql_query": "SELECT region, AVG(shipping_cost) AS avg_shipping_cost FROM orders GROUP BY region ORDER BY avg_shipping_cost ASC LIMIT 1;", "id": 46}
{"level": "Intermediate", "question": "List the top 3 cities with the highest total sales.", "sql_query": "SELECT city, SUM(sales) AS total_sales FROM orders GROUP BY city ORDER BY total_sales DESC LIMIT 3;", "id": 47}
{"level": "Intermediate", "question": "Find the total profit for orders that were placed in the 'US' market and have 'Critical' order_priority.", "sql_query": "SELECT SUM(profit) FROM orders WHERE market = 'US' AND order_priority = 'Critical';", "id": 48}
{"level": "Intermediate", "question": "Calculate the number of unique customers in each market.", "sql_query": "SELECT market, COUNT(DISTINCT customer_id) AS unique_customers FROM orders GROUP BY market;", "id": 49}
{"level": "Intermediate", "question": "What is the average sales for orders that have a discount of 0?", "sql_query": "SELECT AVG(sales) FROM orders WHERE discount = 0;", "id": 50}
{"level": "Intermediate", "question": "Retrieve the total profit and count of orders for each combination of category and segment.", "sql_query": "SELECT category, segment, SUM(profit) AS total_profit, COUNT(order_id) AS order_count FROM orders GROUP BY category, segment;", "id": 51}
{"level": "Intermediate", "question": "Find the customer with the highest total sales.", "sql_query": "SELECT customer_name, SUM(sales) AS total_sales FROM orders GROUP BY customer_name ORDER BY total_sales DESC LIMIT 1;", "id": 52}
{"level": "Intermediate", "question": "How many order IDs are present in both the orders and returns tables?", "sql_query": "SELECT COUNT(T1.order_id) FROM orders AS T1 INNER JOIN returns AS T2 ON T1.order_id = T2.order_id;", "id": 53}
{"level": "Intermediate", "question": "Calculate the number of orders where ship_date is the same as order_date.", "sql_query": "SELECT COUNT(order_id) FROM orders WHERE ship_date = order_date;", "id": 54}
{"level": "Intermediate", "question": "Find the average profit for orders with a loss (profit < 0) for each country.", "sql_query": "SELECT country, AVG(profit) AS avg_loss FROM orders WHERE profit < 0 GROUP BY country;", "id": 55}
{"level": "Intermediate", "question": "List the product_name and total quantity sold for all products that have ever been returned.", "sql_query": "SELECT T1.product_name, SUM(T1.quantity) AS total_quantity FROM orders AS T1 INNER JOIN returns AS T2 ON T1.order_id = T2.order_id GROUP BY T1.product_name ORDER BY total_quantity DESC;", "id": 56}
{"level": "Intermediate", "question": "What is the total profit for orders placed in '2013'?", "sql_query": "SELECT SUM(profit) FROM orders WHERE order_date LIKE '2013%';", "id": 57}
{"level": "Intermediate", "question": "Count the number of orders for each distinct combination of market and order_priority.", "sql_query": "SELECT market, order_priority, COUNT(order_id) AS order_count FROM orders GROUP BY market, order_priority;", "id": 58}
{"level": "Intermediate", "question": "Which category has the highest total profit from orders with a discount greater than 0.1?", "sql_query": "SELECT category, SUM(profit) AS total_profit FROM orders WHERE discount > 0.1 GROUP BY category ORDER BY total_profit DESC LIMIT 1;", "id": 59}
{"level": "Intermediate", "question": "Find the number of unique products ordered by the customer 'Deanra Eno'.", "sql_query": "SELECT COUNT(DISTINCT product_id) FROM orders WHERE customer_name = 'Deanra Eno';", "id": 60}
{"level": "Intermediate", "question": "List the top 5 customers (by total sales) who have *not* returned any orders.", "sql_query": "SELECT T1.customer_name, SUM(T1.sales) AS total_sales FROM orders AS T1 LEFT JOIN returns AS T2 ON T1.order_id = T2.order_id WHERE T2.order_id IS NULL GROUP BY T1.customer_name ORDER BY total_sales DESC LIMIT 5;", "id": 61}
{"level": "Intermediate", "question": "Calculate the ratio of total returned orders to total orders.", "sql_query": "SELECT (SELECT COUNT(DISTINCT order_id) FROM returns) * 1.0 / (SELECT COUNT(DISTINCT order_id) FROM orders) AS return_rate;", "id": 62}
{"level": "Intermediate", "question": "Find the average profit per order for each state.", "sql_query": "SELECT state, AVG(profit) AS avg_profit FROM orders GROUP BY state;", "id": 63}
{"level": "Intermediate", "question": "List all orders that were returned and had a negative profit.", "sql_query": "SELECT T1.* FROM orders AS T1 INNER JOIN returns AS T2 ON T1.order_id = T2.order_id WHERE T1.profit < 0;", "id": 64}
{"level": "Intermediate", "question": "What is the total profit for orders where the shipping cost is less than the average shipping cost?", "sql_query": "SELECT SUM(profit) FROM orders WHERE shipping_cost < (SELECT AVG(shipping_cost) FROM orders);", "id": 65}
{"level": "Intermediate", "question": "Find the market that has the most returned orders.", "sql_query": "SELECT market, COUNT(order_id) AS returned_orders FROM returns GROUP BY market ORDER BY returned_orders DESC LIMIT 1;", "id": 66}
{"level": "Intermediate", "question": "What is the total sales for each quarter (Q1, Q2, Q3, Q4) across all years?", "sql_query": "SELECT CASE WHEN CAST(SUBSTR(order_date, 6, 2) AS INT) BETWEEN 1 AND 3 THEN 'Q1' WHEN CAST(SUBSTR(order_date, 6, 2) AS INT) BETWEEN 4 AND 6 THEN 'Q2' WHEN CAST(SUBSTR(order_date, 6, 2) AS INT) BETWEEN 7 AND 9 THEN 'Q3' ELSE 'Q4' END AS quarter, SUM(sales) AS total_sales FROM orders GROUP BY quarter;", "id": 67}
{"level": "Advanced", "question": "Find the second most profitable product name overall.", "sql_query": "SELECT product_name, total_profit FROM (SELECT product_name, SUM(profit) AS total_profit FROM orders GROUP BY product_name ORDER BY total_profit DESC LIMIT 2) ORDER BY total_profit ASC LIMIT 1;", "id": 68}
{"level": "Advanced", "question": "Calculate the cumulative total sales over order_date for the 'Technology' category.", "sql_query": "SELECT order_date, sales, SUM(sales) OVER (ORDER BY order_date) AS cumulative_sales FROM orders WHERE category = 'Technology' ORDER BY order_date;", "id": 69}
{"level": "Advanced", "question": "Identify the order with the highest sales in each market.", "sql_query": "WITH RankedOrders AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY market ORDER BY sales DESC) as rn FROM orders) SELECT * FROM RankedOrders WHERE rn = 1;", "id": 70}
{"level": "Advanced", "question": "Determine the year-over-year (YoY) percentage change in total sales.", "sql_query": "WITH YearlySales AS (SELECT CAST(SUBSTR(order_date, 1, 4) AS INT) AS order_year, SUM(sales) AS current_year_sales FROM orders GROUP BY order_year) SELECT T1.order_year, T1.current_year_sales, T2.current_year_sales AS previous_year_sales, ((T1.current_year_sales - T2.current_year_sales) * 100.0 / T2.current_year_sales) AS YoY_sales_change_percent FROM YearlySales AS T1 LEFT JOIN YearlySales AS T2 ON T1.order_year = T2.order_year + 1 ORDER BY T1.order_year;", "id": 71}
{"level": "Advanced", "question": "Calculate the running average profit of the last 3 orders, ordered by row_id.", "sql_query": "SELECT row_id, order_date, profit, AVG(profit) OVER (ORDER BY row_id ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS running_avg_profit FROM orders ORDER BY row_id;", "id": 72}
{"level": "Advanced", "question": "Find the top 10 products (by sales) that have been returned.", "sql_query": "SELECT T1.product_name, SUM(T1.sales) AS total_sales FROM orders AS T1 INNER JOIN returns AS T2 ON T1.order_id = T2.order_id GROUP BY T1.product_name ORDER BY total_sales DESC LIMIT 10;", "id": 73}
{"level": "Advanced", "question": "Calculate the number of distinct products sold per customer, and identify the customer who has bought the most distinct products.", "sql_query": "SELECT customer_name, COUNT(DISTINCT product_id) AS distinct_products_count FROM orders GROUP BY customer_name ORDER BY distinct_products_count DESC LIMIT 1;", "id": 74}
{"level": "Advanced", "question": "For each market, what is the ratio of total sales from returned orders to total sales from all orders?", "sql_query": "WITH SalesData AS (SELECT market, SUM(sales) AS total_sales, SUM(CASE WHEN T2.order_id IS NOT NULL THEN T1.sales ELSE 0 END) AS returned_sales FROM orders AS T1 LEFT JOIN returns AS T2 ON T1.order_id = T2.order_id GROUP BY market) SELECT market, returned_sales * 1.0 / total_sales AS returned_sales_ratio FROM SalesData;", "id": 75}
{"level": "Advanced", "question": "Find the average sales for each sub-category compared to the overall average sales across all orders.", "sql_query": "SELECT T1.\"sub-category\", AVG(T1.sales) AS sub_category_avg_sales, (SELECT AVG(sales) FROM orders) AS overall_avg_sales FROM orders AS T1 GROUP BY T1.\"sub-category\";", "id": 76}
{"level": "Advanced", "question": "Which customer has the highest number of orders that resulted in a loss (profit < 0)?", "sql_query": "SELECT customer_name, COUNT(order_id) AS loss_order_count FROM orders WHERE profit < 0 GROUP BY customer_name ORDER BY loss_order_count DESC LIMIT 1;", "id": 77}
{"level": "Advanced", "question": "Calculate the difference in sales between the current order and the previous order (based on row_id) for each customer_id.", "sql_query": "SELECT row_id, customer_id, sales, LAG(sales, 1, 0) OVER (PARTITION BY customer_id ORDER BY row_id) AS previous_sales, sales - LAG(sales, 1, 0) OVER (PARTITION BY customer_id ORDER BY row_id) AS sales_difference FROM orders ORDER BY customer_id, row_id;", "id": 78}
{"level": "Advanced", "question": "For each year, what is the most profitable category?", "sql_query": "WITH RankedCategoryProfit AS (SELECT CAST(SUBSTR(order_date, 1, 4) AS INT) AS order_year, category, SUM(profit) AS total_profit, RANK() OVER (PARTITION BY CAST(SUBSTR(order_date, 1, 4) AS INT) ORDER BY SUM(profit) DESC) as profit_rank FROM orders GROUP BY order_year, category) SELECT order_year, category, total_profit FROM RankedCategoryProfit WHERE profit_rank = 1 ORDER BY order_year;", "id": 79}
{"level": "Advanced", "question": "Find all orders that have a profit that is more than twice the average profit for their respective market.", "sql_query": "WITH MarketAvgProfit AS (SELECT market, AVG(profit) AS avg_profit FROM orders GROUP BY market) SELECT T1.* FROM orders AS T1 INNER JOIN MarketAvgProfit AS T2 ON T1.market = T2.market WHERE T1.profit > 2 * T2.avg_profit;", "id": 80}
{"level": "Advanced", "question": "List the top 5 customers whose total sales include at least one returned order.", "sql_query": "SELECT T1.customer_name, SUM(T1.sales) AS total_sales FROM orders AS T1 INNER JOIN returns AS T2 ON T1.order_id = T2.order_id GROUP BY T1.customer_name ORDER BY total_sales DESC LIMIT 5;", "id": 81}
{"level": "Advanced", "question": "Calculate the moving average of sales using a 5-row window (2 preceding, 2 following, current row) ordered by row_id.", "sql_query": "SELECT row_id, sales, AVG(sales) OVER (ORDER BY row_id ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS moving_avg_sales FROM orders ORDER BY row_id;", "id": 82}
{"level": "Advanced", "question": "What is the percentage contribution of each segment's total profit to the overall total profit?", "sql_query": "SELECT segment, SUM(profit) AS total_profit, SUM(profit) * 100.0 / (SELECT SUM(profit) FROM orders) AS profit_percentage FROM orders GROUP BY segment ORDER BY profit_percentage DESC;", "id": 83}
{"level": "Advanced", "question": "Find the top-selling product (by sales) in each region for the Technology category.", "sql_query": "WITH RankedProductSales AS (SELECT region, product_name, SUM(sales) AS total_sales, RANK() OVER (PARTITION BY region ORDER BY SUM(sales) DESC) AS sales_rank FROM orders WHERE category = 'Technology' GROUP BY region, product_name) SELECT region, product_name, total_sales FROM RankedProductSales WHERE sales_rank = 1;", "id": 84}
{"level": "Advanced", "question": "Identify the order ID and order date of the first order placed by each customer_id.", "sql_query": "WITH FirstOrder AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY order_date ASC) as rn FROM orders) SELECT order_id, order_date, customer_id FROM FirstOrder WHERE rn = 1;", "id": 85}
{"level": "Advanced", "question": "Calculate the total sales for each day, only including days where the total sales exceeded $5000.", "sql_query": "SELECT order_date, SUM(sales) AS daily_sales FROM orders GROUP BY order_date HAVING SUM(sales) > 5000 ORDER BY daily_sales DESC;", "id": 86}
{"level": "Advanced", "question": "Find the total sales for orders that were shipped with 'First Class' and had a delivery time (ship_date - order_date) of exactly 2 days.", "sql_query": "SELECT SUM(sales) FROM orders WHERE ship_mode = 'First Class' AND (JULIANDAY(ship_date) - JULIANDAY(order_date)) = 2;", "id": 87}
{"level": "Advanced", "question": "List the customers who have placed orders in at least 3 different markets.", "sql_query": "SELECT customer_name FROM orders GROUP BY customer_name HAVING COUNT(DISTINCT market) >= 3;", "id": 88}
{"level": "Advanced", "question": "Find the top sub-category in each category based on total profit, excluding all orders that were returned.", "sql_query": "WITH NonReturnedOrders AS (SELECT T1.* FROM orders AS T1 LEFT JOIN returns AS T2 ON T1.order_id = T2.order_id WHERE T2.order_id IS NULL), RankedProfit AS (SELECT category, \"sub-category\", SUM(profit) AS total_profit, RANK() OVER (PARTITION BY category ORDER BY SUM(profit) DESC) as profit_rank FROM NonReturnedOrders GROUP BY category, \"sub-category\") SELECT category, \"sub-category\", total_profit FROM RankedProfit WHERE profit_rank = 1;", "id": 89}
{"level": "Advanced", "question": "Calculate the number of orders and the total profit for each year-month combination.", "sql_query": "SELECT SUBSTR(order_date, 1, 7) AS year_month, COUNT(order_id) AS order_count, SUM(profit) AS total_profit FROM orders GROUP BY year_month ORDER BY year_month;", "id": 90}
{"level": "Advanced", "question": "Find the product with the highest sales and the product with the lowest sales.", "sql_query": "SELECT 'Highest Sales' AS sales_type, product_name, total_sales FROM (SELECT product_name, SUM(sales) AS total_sales FROM orders GROUP BY product_name ORDER BY total_sales DESC LIMIT 1) UNION ALL SELECT 'Lowest Sales' AS sales_type, product_name, total_sales FROM (SELECT product_name, SUM(sales) AS total_sales FROM orders GROUP BY product_name ORDER BY total_sales ASC LIMIT 1);", "id": 91}
{"level": "Advanced", "question": "What is the average discount for orders with a profit greater than the average profit of all orders?", "sql_query": "SELECT AVG(discount) FROM orders WHERE profit > (SELECT AVG(profit) FROM orders);", "id": 92}
{"level": "Advanced", "question": "For orders with 'Critical' priority, what is the maximum sales value of a product in each country?", "sql_query": "SELECT country, MAX(sales) AS max_critical_sales FROM orders WHERE order_priority = 'Critical' GROUP BY country;", "id": 93}
{"level": "Advanced", "question": "Find the total sales and total profit for each order_id, and then list the top 5 order_id's by profit that also had a return.", "sql_query": "WITH OrderSummary AS (SELECT order_id, SUM(sales) AS order_sales, SUM(profit) AS order_profit FROM orders GROUP BY order_id) SELECT T1.order_id, T1.order_profit, T1.order_sales FROM OrderSummary AS T1 INNER JOIN returns AS T2 ON T1.order_id = T2.order_id ORDER BY T1.order_profit DESC LIMIT 5;", "id": 94}
{"level": "Advanced", "question": "Identify all customers who have placed an order in all three main segments: 'Consumer', 'Corporate', and 'Home Office'.", "sql_query": "SELECT customer_name FROM orders WHERE segment IN ('Consumer', 'Corporate', 'Home Office') GROUP BY customer_name HAVING COUNT(DISTINCT segment) = 3;", "id": 95}
{"level": "Advanced", "question": "Calculate the total sales for each product_name as a percentage of the total sales for its respective category.", "sql_query": "WITH CategorySales AS (SELECT category, SUM(sales) AS category_total_sales FROM orders GROUP BY category) SELECT T1.product_name, T1.category, SUM(T1.sales) AS product_sales, (SUM(T1.sales) * 100.0 / T2.category_total_sales) AS percent_of_category_sales FROM orders AS T1 INNER JOIN CategorySales AS T2 ON T1.category = T2.category GROUP BY T1.product_name, T1.category, T2.category_total_sales ORDER BY T1.category, percent_of_category_sales DESC;", "id": 96}
{"level": "Advanced", "question": "For each customer_id, calculate the difference in days between their latest order and their earliest order.", "sql_query": "SELECT customer_id, JULIANDAY(MAX(order_date)) - JULIANDAY(MIN(order_date)) AS days_between_first_and_last_order FROM orders GROUP BY customer_id HAVING COUNT(DISTINCT order_id) > 1;", "id": 97}
{"level": "Advanced", "question": "What is the average sales price of a product, defined as (sales / quantity), for each product that has a total quantity sold greater than 100?", "sql_query": "WITH ProductAvgPrice AS (SELECT product_id, SUM(sales) / SUM(quantity) AS avg_price, SUM(quantity) AS total_quantity FROM orders GROUP BY product_id HAVING total_quantity > 100) SELECT T1.product_name, T2.avg_price FROM orders AS T1 INNER JOIN ProductAvgPrice AS T2 ON T1.product_id = T2.product_id GROUP BY T1.product_name, T2.avg_price;", "id": 98}
{"level": "Advanced", "question": "Find the total profit for each year and category, then rank the categories by profit within each year.", "sql_query": "SELECT CAST(SUBSTR(order_date, 1, 4) AS INT) AS order_year, category, SUM(profit) AS total_profit, RANK() OVER (PARTITION BY CAST(SUBSTR(order_date, 1, 4) AS INT) ORDER BY SUM(profit) DESC) AS profit_rank FROM orders GROUP BY order_year, category ORDER BY order_year, profit_rank;", "id": 99}
{"level": "Advanced", "question": "Identify all orders where the profit is positive AND the order has been returned.", "sql_query": "SELECT T1.* FROM orders AS T1 INNER JOIN returns AS T2 ON T1.order_id = T2.order_id WHERE T1.profit > 0;", "id": 100}
